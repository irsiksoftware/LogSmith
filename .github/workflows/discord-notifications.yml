name: Discord Notifications

on:
  push:
    branches: [main, master, develop]
  pull_request:
    types: [opened, closed, reopened]
  release:
    types: [published]

jobs:
  notify-commit:
    name: Notify Discord - Commit
    runs-on: [self-hosted, Windows]
    if: github.event_name == 'push'
    steps:
      - name: Send Discord notification
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.COMMIT_WEBHOOK }}
          embed-title: "New Commit to ${{ github.ref_name }}"
          embed-description: |
            ${{ github.event.head_commit.message }}

            **Author:** ${{ github.event.head_commit.author.name }}
            **Commit:** [`${{ github.sha }}`](${{ github.event.head_commit.url }})
          embed-url: ${{ github.event.head_commit.url }}
          embed-color: "5814783"
          embed-timestamp: ${{ github.event.head_commit.timestamp }}
          embed-footer-text: ${{ github.repository }}

  notify-pull-request:
    name: Notify Discord - Pull Request
    runs-on: [self-hosted, Windows]
    if: github.event_name == 'pull_request'
    steps:
      - name: Send Discord notification
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.PULLREQUEST_WEBHOOK }}
          embed-title: "Pull Request ${{ github.event.action }}"
          embed-description: |
            ${{ github.event.pull_request.title }}

            **Author:** ${{ github.event.pull_request.user.login }}
            **Branch:** `${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`
          embed-url: ${{ github.event.pull_request.html_url }}
          embed-color: "3066993"
          embed-timestamp: ${{ github.event.pull_request.updated_at }}
          embed-footer-text: "PR #${{ github.event.pull_request.number }}"

  notify-release:
    name: Notify Discord - Release
    runs-on: [self-hosted, Windows]
    if: github.event_name == 'release'
    steps:
      - name: Send Discord notification
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.RELEASE_WEBHOOK }}
          embed-title: "Release: ${{ github.event.release.tag_name }}"
          embed-description: |
            ${{ github.event.release.name || github.event.release.tag_name }}

            **Author:** ${{ github.event.release.author.login }}
          embed-url: ${{ github.event.release.html_url }}
          embed-color: "3066993"
          embed-timestamp: ${{ github.event.release.published_at }}
          embed-footer-text: ${{ github.repository }}
